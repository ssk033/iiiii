=============================================================
========================= 9(a) — SQL =========================
===================== SHIPMENT DATABASE ======================
=============================================================


-------------------------------------------------------------
-- TABLE: CUSTOMER
-- PK: cust#
-------------------------------------------------------------
CREATE TABLE CUSTOMER (
    cust# INT PRIMARY KEY,
    cname VARCHAR(50),
    city VARCHAR(50)
);


-------------------------------------------------------------
-- TABLE: ORDER
-- PK: order#
-- FK: cust# → CUSTOMER(cust#)
-------------------------------------------------------------
CREATE TABLE ORDERS (
    order# INT PRIMARY KEY,
    odate DATE,
    cust# INT,
    ord_Amt INT,
    FOREIGN KEY (cust#) REFERENCES CUSTOMER(cust#)
);


-------------------------------------------------------------
-- TABLE: ITEM
-- PK: item#
-------------------------------------------------------------
CREATE TABLE ITEM (
    item# INT PRIMARY KEY,
    unit_price INT
);


-------------------------------------------------------------
-- TABLE: ORDER_ITEM
-- PK: (order#, item#)
-- FKs: order# → ORDERS, item# → ITEM
-------------------------------------------------------------
CREATE TABLE ORDER_ITEM (
    order# INT,
    item# INT,
    qty INT,
    FOREIGN KEY (order#) REFERENCES ORDERS(order#),
    FOREIGN KEY (item#) REFERENCES ITEM(item#)
);


-------------------------------------------------------------
-- TABLE: SHIPMENT
-- PK: order#
-- FK: order# → ORDERS(order#)
-------------------------------------------------------------
CREATE TABLE SHIPMENT (
    order# INT PRIMARY KEY,
    ship_date DATE,
    FOREIGN KEY (order#) REFERENCES ORDERS(order#)
);


=============================================================
======================== INSERT DATA =========================
=============================================================

-------------------------------------------------------------
-- INSERT CUSTOMERS
-------------------------------------------------------------
INSERT INTO CUSTOMER VALUES
(1, 'Ramesh', 'Bangalore'),
(2, 'Suresh', 'Mysore'),
(3, 'Asha', 'Delhi'),
(4, 'Karan', 'Mumbai'),
(5, 'Rekha', 'Chennai');


-------------------------------------------------------------
-- INSERT ORDERS
-------------------------------------------------------------
INSERT INTO ORDERS VALUES
(101, '2024-01-10', 1, 5000),
(102, '2024-01-10', 1, 3000),
(103, '2024-01-11', 1, 2000),
(104, '2024-01-11', 2, 2500),
(105, '2024-01-12', 3, 4000);


-------------------------------------------------------------
-- INSERT ITEMS
-------------------------------------------------------------
INSERT INTO ITEM VALUES
(501, 50),
(502, 80),
(503, 120),
(504, 200),
(505, 300);


-------------------------------------------------------------
-- INSERT ORDER ITEMS
-------------------------------------------------------------
INSERT INTO ORDER_ITEM VALUES
(101, 501, 10),
(102, 503, 5),
(103, 505, 2),
(104, 502, 4),
(105, 504, 3);


-------------------------------------------------------------
-- INSERT SHIPMENTS
-------------------------------------------------------------
INSERT INTO SHIPMENT VALUES
(101, '2024-01-12'),
(102, '2024-01-12'),
(103, '2024-01-13'),
(104, '2024-01-13'),
(105, '2024-01-14');


=============================================================
========================== QUERIES ===========================
=============================================================


-------------------------------------------------------------
-- QUERY i:
-- List the customer names who have placed MORE THAN 2 orders
-------------------------------------------------------------
SELECT cname
FROM CUSTOMER
WHERE cust# IN (
    SELECT cust#
    FROM ORDERS
    GROUP BY cust#
    HAVING COUNT(order#) > 2
);


-------------------------------------------------------------
-- QUERY ii:
-- Find TOTAL order amount for EACH DAY
-------------------------------------------------------------
SELECT odate, SUM(ord_Amt) AS TotalAmount
FROM ORDERS
GROUP BY odate;


-------------------------------------------------------------
-- QUERY iii:
-- List customer details who has LARGEST order amount
-------------------------------------------------------------
SELECT C.*
FROM CUSTOMER C
WHERE C.cust# = (
    SELECT cust#
    FROM ORDERS
    WHERE ord_Amt = (SELECT MAX(ord_Amt) FROM ORDERS)
);


=============================================================
========================= END OF FILE ========================
=============================================================
